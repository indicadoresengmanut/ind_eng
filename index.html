<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboards Power BI - TV</title>
    <style>
        /* RESET COMPLETO PARA TV */
        * {
            margin: 0;
            padding: 0;
            border: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000000;
            position: fixed; /* Importante para TV */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            overflow: hidden;
        }
        
        .dashboard-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            background: #000000;
        }
        
        .dashboard-frame.active {
            display: block;
        }
        
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            background: #000000;
            padding: 20px;
            z-index: 1000;
            border: 2px solid #333;
        }
        
        .info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            font-size: 16px;
            z-index: 1000;
            border: 1px solid #333;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff4444;
            background: #000000;
            padding: 30px;
            text-align: center;
            border: 2px solid #ff4444;
            display: none;
            z-index: 1000;
            max-width: 80%;
        }
        
        /* Garantir que tudo ocupe 100% */
        #dashboard-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loader" id="loader">
            <h3>CARREGANDO DASHBOARD</h3>
            <p id="loader-text">Aguarde...</p>
        </div>
        
        <div class="error" id="error">
            <h3>ERRO DE CARREGAMENTO</h3>
            <p id="error-text">Tentando reconectar...</p>
        </div>
        
        <div id="dashboard-container"></div>
        
        <div class="info" id="info">Dashboard 1/3</div>
    </div>

    <script>
        // Configuração otimizada para TV
        const CONFIG = {
            dashboards: [
                {
                    name: "Indicadores Engenharia",
                    url: "https://app.powerbi.com/view?r=eyJrIjoiNjIyZjNiM2EtY2EwNi00YjY1LWI4Y2YtMTRkZDUwNmU4MTJmIiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9"
                },
                {
                    name: "Acompanhamento 2025", 
                    url: "https://app.powerbi.com/view?r=eyJrIjoiOTA1M2ZiYzItNWQ0NS00OTgxLWJmZTMtMWFhNDQ3MWZlNjg2IiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9"
                },
                {
                    name: "Acomp. Inspeções",
                    url: "https://app.powerbi.com/view?r=eyJrIjoiODYyNTZmMWMtMzM4OC00NmQ4LWFhYTItYjNmOTZhNzdlNmMwIiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9"
                }
            ],
            displayTime: 60000,
            loadTimeout: 45000,
            retryDelay: 5000
        };

        // Estado global
        let currentDashboard = 0;
        let isLoaded = false;
        let retryCount = 0;
        const MAX_RETRIES = 3;

        // Elementos DOM
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const error = document.getElementById('error');
        const errorText = document.getElementById('error-text');
        const info = document.getElementById('info');
        const container = document.getElementById('dashboard-container');

        // Função para forçar 100% da tela
        function forceFullScreen() {
            console.log('🔧 Aplicando ajustes de tela cheia...');
            
            // Aplicar estilos diretamente nos elementos
            document.documentElement.style.width = '100%';
            document.documentElement.style.height = '100%';
            document.documentElement.style.overflow = 'hidden';
            document.documentElement.style.position = 'fixed';
            
            document.body.style.width = '100%';
            document.body.style.height = '100%';
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.top = '0';
            document.body.style.left = '0';
            document.body.style.right = '0';
            document.body.style.bottom = '0';
            
            // Container principal
            const mainContainer = document.querySelector('.container');
            if (mainContainer) {
                mainContainer.style.width = '100%';
                mainContainer.style.height = '100%';
                mainContainer.style.position = 'fixed';
                mainContainer.style.top = '0';
                mainContainer.style.left = '0';
            }
            
            // Container de dashboards
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.position = 'fixed';
            container.style.top = '0';
            container.style.left = '0';
            
            console.log('✅ Ajustes de tela aplicados');
        }

        // Inicialização
        function initialize() {
            console.log('🚀 INICIANDO SISTEMA TV');
            
            // Forçar ajustes de tela primeiro
            forceFullScreen();
            
            showLoader('Ajustando tela...');
            
            // Aguardar e iniciar
            setTimeout(() => {
                loadCurrentDashboard();
            }, 1000);
        }

        // Mostrar loader
        function showLoader(message) {
            loaderText.textContent = message;
            loader.style.display = 'block';
            error.style.display = 'none';
        }

        // Mostrar erro
        function showError(message) {
            errorText.textContent = message;
            error.style.display = 'block';
            loader.style.display = 'none';
        }

        // Esconder overlays
        function hideOverlays() {
            loader.style.display = 'none';
            error.style.display = 'none';
        }

        // Atualizar informação
        function updateInfo() {
            const dashboard = CONFIG.dashboards[currentDashboard];
            info.textContent = `${dashboard.name} (${currentDashboard + 1}/${CONFIG.dashboards.length})`;
        }

        // Carregar dashboard atual
        function loadCurrentDashboard() {
            retryCount = 0;
            const dashboard = CONFIG.dashboards[currentDashboard];
            
            console.log(`📊 CARREGANDO: ${dashboard.name}`);
            showLoader(`Carregando: ${dashboard.name}`);
            updateInfo();
            
            createDashboardFrame(dashboard.url);
        }

        // Criar iframe do dashboard
        function createDashboardFrame(url) {
            // Limpar container completamente
            container.innerHTML = '';
            
            // Criar iframe com dimensões fixas para TV
            const iframe = document.createElement('iframe');
            iframe.className = 'dashboard-frame';
            iframe.src = url;
            
            // DIMENSÕES ABSOLUTAS PARA TV
            iframe.style.position = 'fixed';
            iframe.style.top = '0';
            iframe.style.left = '0';
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.border = 'none';
            iframe.style.background = '#000000';
            iframe.style.overflow = 'hidden';
            
            // Configurações para Power BI
            iframe.setAttribute('allowfullscreen', 'true');
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('scrolling', 'no');
            iframe.setAttribute('allow', 'fullscreen');
            
            // Adicionar ao container
            container.appendChild(iframe);
            
            // Timeout de carregamento
            const loadTimeout = setTimeout(() => {
                if (!isLoaded) {
                    handleLoadError('Timeout - Verifique a conexão');
                }
            }, CONFIG.loadTimeout);

            // Evento de load
            iframe.onload = function() {
                clearTimeout(loadTimeout);
                console.log('✅ DASHBOARD CARREGADO');
                handleLoadSuccess(iframe);
            };

            // Evento de error
            iframe.onerror = function() {
                clearTimeout(loadTimeout);
                handleLoadError('Erro de carregamento');
            };
        }

        // Sucesso no carregamento
        function handleLoadSuccess(iframe) {
            isLoaded = true;
            iframe.classList.add('active');
            hideOverlays();
            
            console.log('🎯 DASHBOARD ATIVO - PRÓXIMO EM ' + (CONFIG.displayTime/1000) + 's');
            
            // Próximo dashboard
            setTimeout(nextDashboard, CONFIG.displayTime);
        }

        // Erro no carregamento
        function handleLoadError(message) {
            console.error(`❌ ${message}`);
            isLoaded = false;
            
            if (retryCount < MAX_RETRIES) {
                retryCount++;
                showError(`${message} - Tentativa ${retryCount}/${MAX_RETRIES}`);
                
                setTimeout(() => {
                    loadCurrentDashboard();
                }, CONFIG.retryDelay);
            } else {
                showError(`${message} - Pulando para próximo`);
                
                setTimeout(() => {
                    nextDashboard();
                }, 3000);
            }
        }

        // Próximo dashboard
        function nextDashboard() {
            currentDashboard = (currentDashboard + 1) % CONFIG.dashboards.length;
            isLoaded = false;
            console.log(`🔄 PRÓXIMO DASHBOARD: ${currentDashboard + 1}`);
            loadCurrentDashboard();
        }

        // Modo tela cheia forçado
        function forceTVFullscreen() {
            console.log('🖥️  TENTANDO TELA CHEIA...');
            
            // Métodos alternativos para TV
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(e => console.log('Fullscreen error:', e));
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
            
            // Forçar redimensionamento
            setTimeout(forceFullScreen, 1000);
        }

        // Sistema de keep-alive
        function setupKeepAlive() {
            // Atividade periódica
            setInterval(() => {
                const event = new MouseEvent('mousemove');
                document.dispatchEvent(event);
            }, 25000);

            // Limpeza a cada 30 minutos (menos frequente)
            setInterval(() => {
                console.log('🔄 LIMPEZA PROGRAMADA');
                window.location.reload();
            }, 1800000);
        }

        // Quando a página carregar
        window.onload = function() {
            console.log('📺 TV - PÁGINA CARREGADA');
            
            // Aplicar ajustes imediatamente
            forceFullScreen();
            
            // Sistema keep-alive
            setupKeepAlive();
            
            // Tentar tela cheia
            setTimeout(forceTVFullscreen, 500);
            
            // Iniciar sistema
            setTimeout(initialize, 1000);
        };

        // Fallback de carregamento
        if (document.readyState === 'complete') {
            window.onload();
        }

        // Redimensionar quando a janela mudar (para TV)
        window.onresize = function() {
            console.log('📏 REDIMENSIONANDO...');
            forceFullScreen();
        };

        console.log('✨ SISTEMA TV PRONTO');
    </script>
</body>
</html>
