<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboards - TV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000000;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
        }
        
        .dashboard-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .dashboard-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
        
        .dashboard-item.active {
            display: block;
        }
        
        .dashboard-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #000000;
        }
        
        .status {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.9);
            padding: 10px 15px;
            font-size: 16px;
            z-index: 1000;
            border: 1px solid #333;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            background: rgba(0,0,0,0.9);
            padding: 30px;
            z-index: 1000;
            border: 2px solid #333;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            background: rgba(0,0,0,0.95);
            padding: 30px;
            text-align: center;
            border: 2px solid #ff6b6b;
            z-index: 1000;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div class="screen">
        <div class="loading" id="loading">
            <h2>INICIANDO SISTEMA</h2>
            <p id="loading-text">Carregando primeiro dashboard...</p>
        </div>
        
        <div class="error" id="error" style="display: none;">
            <h2>ERRO</h2>
            <p id="error-text"></p>
        </div>
        
        <div class="dashboard-container" id="dashboard-container">
            <!-- Dashboards ser√£o criados aqui -->
        </div>
        
        <div class="status" id="status">Dashboard 1/3</div>
    </div>

    <script>
        // CONFIGURA√á√ÉO PRINCIPAL
        const CONFIG = {
            dashboards: [
                {
                    name: "Indicadores Engenharia",
                    // URL alternativa sem restri√ß√µes
                    url: "https://app.powerbi.com/view?r=eyJrIjoiNjIyZjNiM2EtY2EwNi00YjY1LWI4Y2YtMTRkZDUwNmU4MTJmIiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9",
                    id: "dashboard-1"
                },
                {
                    name: "Acompanhamento 2025", 
                    url: "https://app.powerbi.com/view?r=eyJrIjoiOTA1M2ZiYzItNWQ0NS00OTgxLWJmZTMtMWFhNDQ3MWZlNjg2IiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9",
                    id: "dashboard-2"
                },
                {
                    name: "Acomp. Inspe√ß√µes",
                    url: "https://app.powerbi.com/view?r=eyJrIjoiODYyNTZmMWMtMzM4OC00NmQ4LWFhYTItYjNmOTZhNzdlNmMwIiwidCI6ImE2NjFhZDU2LTQ4YzctNGFmNC04MGY2LTE0YzViMGNmOTk0ZCJ9",
                    id: "dashboard-3"
                }
            ],
            displayTime: 60000,    // 60 segundos
            loadTimeout: 40000,    // 40 segundos
            retryCount: 2
        };

        // VARI√ÅVEIS GLOBAIS
        let currentIndex = 0;
        let isLoading = false;
        let loadAttempts = {};

        // ELEMENTOS DA P√ÅGINA
        const loadingEl = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const errorEl = document.getElementById('error');
        const errorText = document.getElementById('error-text');
        const statusEl = document.getElementById('status');
        const container = document.getElementById('dashboard-container');

        // INICIALIZA√á√ÉO DO SISTEMA
        function initSystem() {
            console.log('üîÑ INICIANDO SISTEMA DE DASHBOARDS');
            
            // Inicializar contadores de tentativas
            CONFIG.dashboards.forEach((dashboard, index) => {
                loadAttempts[index] = 0;
            });
            
            // Criar todos os containers de dashboard
            createDashboardContainers();
            
            // Carregar primeiro dashboard
            loadDashboard(currentIndex);
        }

        // CRIAR CONTAINERS PARA TODOS OS DASHBOARDS
        function createDashboardContainers() {
            container.innerHTML = '';
            
            CONFIG.dashboards.forEach((dashboard, index) => {
                const dashboardEl = document.createElement('div');
                dashboardEl.className = 'dashboard-item';
                dashboardEl.id = dashboard.id;
                
                const iframe = document.createElement('iframe');
                iframe.className = 'dashboard-iframe';
                iframe.id = `iframe-${index}`;
                iframe.setAttribute('allowfullscreen', 'true');
                iframe.setAttribute('frameborder', '0');
                iframe.setAttribute('scrolling', 'no');
                
                dashboardEl.appendChild(iframe);
                container.appendChild(dashboardEl);
            });
        }

        // CARREGAR DASHBOARD ESPEC√çFICO
        function loadDashboard(index) {
            if (isLoading) return;
            
            isLoading = true;
            const dashboard = CONFIG.dashboards[index];
            
            console.log(`üìä CARREGANDO: ${dashboard.name}`);
            updateLoading(`Iniciando: ${dashboard.name}`);
            updateStatus(index);
            
            const iframe = document.getElementById(`iframe-${index}`);
            const dashboardEl = document.getElementById(dashboard.id);
            
            // Verificar se j√° est√° carregado
            if (iframe.src && iframe.src === dashboard.url) {
                console.log('‚úÖ J√Å CARREGADO - MOSTRANDO');
                showDashboard(index);
                return;
            }
            
            // Tentar carregar o iframe
            loadAttempts[index]++;
            
            // M√©todo 1: Carregamento direto
            attemptDirectLoad(iframe, dashboard.url, index);
        }

        // TENTATIVA DE CARREGAMENTO DIRETO
        function attemptDirectLoad(iframe, url, index) {
            console.log(`üîó TENTATIVA ${loadAttempts[index]}: Carregamento direto`);
            
            iframe.src = url;
            
            const loadTimer = setTimeout(() => {
                handleLoadTimeout(index);
            }, CONFIG.loadTimeout);

            // Evento de load
            iframe.onload = function() {
                clearTimeout(loadTimer);
                handleLoadSuccess(index);
            };

            // Evento de error
            iframe.onerror = function() {
                clearTimeout(loadTimer);
                handleLoadError(index, 'Erro no carregamento');
            };
        }

        // SUCESSO NO CARREGAMENTO
        function handleLoadSuccess(index) {
            console.log('üéâ DASHBOARD CARREGADO COM SUCESSO');
            isLoading = false;
            hideLoading();
            showDashboard(index);
            
            // Programar pr√≥ximo dashboard
            scheduleNextDashboard();
        }

        // ERRO NO CARREGAMENTO
        function handleLoadError(index, message) {
            console.error(`‚ùå ERRO: ${message}`);
            
            if (loadAttempts[index] <= CONFIG.retryCount) {
                console.log(`üîÑ TENTATIVA ${loadAttempts[index]}/${CONFIG.retryCount}`);
                updateLoading(`Tentativa ${loadAttempts[index]}/${CONFIG.retryCount}`);
                
                setTimeout(() => {
                    loadDashboard(index);
                }, 3000);
            } else {
                showError(`N√£o foi poss√≠vel carregar: ${CONFIG.dashboards[index].name}`);
                setTimeout(() => {
                    nextDashboard();
                }, 5000);
            }
        }

        // TIMEOUT NO CARREGAMENTO
        function handleLoadTimeout(index) {
            console.log('‚è∞ TIMEOUT NO CARREGAMENTO');
            handleLoadError(index, 'Timeout - Verifique a conex√£o');
        }

        // MOSTRAR DASHBOARD
        function showDashboard(index) {
            // Esconder todos os dashboards
            document.querySelectorAll('.dashboard-item').forEach(el => {
                el.classList.remove('active');
            });
            
            // Mostrar dashboard atual
            const dashboardEl = document.getElementById(CONFIG.dashboards[index].id);
            if (dashboardEl) {
                dashboardEl.classList.add('active');
            }
            
            console.log(`üëÅÔ∏è  MOSTRANDO DASHBOARD ${index + 1}`);
        }

        // PR√ìXIMO DASHBOARD
        function nextDashboard() {
            hideError();
            currentIndex = (currentIndex + 1) % CONFIG.dashboards.length;
            console.log(`‚û°Ô∏è  PR√ìXIMO: ${currentIndex + 1}`);
            loadDashboard(currentIndex);
        }

        // PROGRAMAR PR√ìXIMO DASHBOARD
        function scheduleNextDashboard() {
            console.log(`‚è∞ PR√ìXIMO DASHBOARD EM ${CONFIG.displayTime/1000} SEGUNDOS`);
            setTimeout(nextDashboard, CONFIG.displayTime);
        }

        // ATUALIZAR STATUS
        function updateStatus(index) {
            const dashboard = CONFIG.dashboards[index];
            statusEl.textContent = `${dashboard.name} (${index + 1}/${CONFIG.dashboards.length})`;
        }

        // ATUALIZAR LOADING
        function updateLoading(message) {
            loadingText.textContent = message;
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
        }

        // ESCONDER LOADING
        function hideLoading() {
            loadingEl.style.display = 'none';
        }

        // MOSTRAR ERRO
        function showError(message) {
            errorText.textContent = message;
            errorEl.style.display = 'block';
            loadingEl.style.display = 'none';
        }

        // ESCONDER ERRO
        function hideError() {
            errorEl.style.display = 'none';
        }

        // FOR√áAR TELA CHEIA
        function forceFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(e => console.log('Fullscreen n√£o suportado'));
            }
        }

        // MANTER SISTEMA ATIVO
        function setupActivityMonitor() {
            // Prevenir timeout por inatividade
            setInterval(() => {
                document.dispatchEvent(new MouseEvent('mousemove'));
            }, 30000);
            
            // Recarregar a cada 2 horas
            setInterval(() => {
                console.log('üîÑ RECARREGANDO PARA LIMPEZA');
                window.location.reload();
            }, 7200000);
        }

        // INICIAR QUANDO A P√ÅGINA CARREGAR
        window.addEventListener('load', function() {
            console.log('üöÄ P√ÅGINA CARREGADA - INICIANDO');
            
            // Configurar monitor de atividade
            setupActivityMonitor();
            
            // Tentar tela cheia
            setTimeout(forceFullscreen, 1000);
            
            // Iniciar sistema
            setTimeout(initSystem, 500);
        });

        // FALLBACK SE A P√ÅGINA J√Å ESTIVER CARREGADA
        if (document.readyState === 'complete') {
            window.dispatchEvent(new Event('load'));
        }

        console.log('‚úÖ SISTEMA CONFIGURADO - AGUARDANDO INICIALIZA√á√ÉO');
    </script>
</body>
</html>
